
fileNames_EMG = ["1503510449718_EMG.csv","1503512024740_EMG.csv","1503513662628_EMG.csv"	,"1503515171349_EMG.csv"	,"1503523593605_EMG.csv"	,"1503600471339_EMG.csv"	,"1503601791851_EMG.csv"	,"1503604387983_EMG.csv"	,"1503610324174_EMG.csv"	,"1503612761276_EMG.csv"	,"1503614529248_EMG.csv"	,"1503616371604_EMG.csv","1503618071641_EMG.csv"	,"1503683563307_EMG.csv"	,"1503685368577_EMG.csv","1503686805336_EMG.csv"	,"1503688257359_EMG.csv","1503695352765_EMG.csv"	,"1503697313323_EMG.csv"	,"1503698678322_EMG.csv"	,"1503701484723_EMG.csv"	,"1503702810845_EMG.csv","1503704008775_EMG.csv"	,"1503944237832_EMG.csv","1503945980566_EMG.csv"	,"1503948467876_EMG.csv"	,"1503955687111_EMG.csv","1503957322493_EMG.csv","1503959170110_EMG.csv"	

];

fileNames_IMU = ["1503510449718_IMU.csv","1503512024740_IMU.csv","1503513662628_IMU.csv"	,"1503515171349_IMU.csv"	,"1503523593605_IMU.csv"	,"1503600471339_IMU.csv"	,"1503601791851_IMU.csv"	,"1503604387983_IMU.csv"	,"1503610324174_IMU.csv"	,"1503612761276_IMU.csv"	,"1503614529248_IMU.csv"	,"1503616371604_IMU.csv","1503618071641_IMU.csv"	,"1503683563307_IMU.csv"	,"1503685368577_IMU.csv","1503686805336_IMU.csv"	,"1503688257359_IMU.csv"	,"1503695352765_IMU.csv"	,"1503697313323_IMU.csv"	,"1503698678322_IMU.csv"	,"1503701484723_IMU.csv"	,"1503702810845_IMU.csv","1503704008775_IMU.csv"	,"1503944237832_IMU.csv","1503945980566_IMU.csv"	,"1503948467876_IMU.csv"	,"1503955687111_IMU.csv","1503957322493_IMU.csv","1503959170110_IMU.csv"	

];

fileNames_gT  = ["1503510449718.csv","1503512024740.csv","1503513662628.csv","1503515171349.csv"	,"1503523593605.csv"	,"1503600471339.csv"	,"1503601791851.csv"	,"1503604387983.csv"	,"1503610324174.csv"	,"1503612761276.csv"	,"1503614529248.csv"	,"1503616371604.csv","1503618071641.csv"	,"1503683563307.csv"	,"1503685368577.csv","1503686805336.csv"	,"1503688257359.csv"	,"1503695352765.csv"	,"1503697313323.csv"	,"1503698678322.csv"	,"1503701484723.csv"	,"1503702810845.csv","1503704008775.csv"	,"1503944237832.csv","1503945980566.csv"	,"1503948467876.csv"	,"1503955687111.csv","1503957322493.csv","1503959170110.csv"	

];

graphNames_dt=["1503510449718_confMat.fig","1503512024740_confMat.fig","1503513662628_confMat.fig"	,"1503515171349_confMat.fig"	,"1503523593605_confMat.fig"	,"1503525230880_confMat.fig","1503600471339_confMat.fig"	,"1503601791851_confMat.fig"	,"1503604387983_confMat.fig"	,"1503610324174_confMat.fig"	,"1503612761276_confMat.fig"	,"1503614529248_confMat.fig"	,"1503616371604_confMat.fig","1503618071641_confMat.fig"	,"1503683563307_confMat.fig"	,"1503685368577_confMat.fig","1503686805336_confMat.fig"	,"1503688257359_confMat.fig"	,"1503695352765_confMat.fig"	,"1503697313323_confMat.fig"	,"1503698678322_confMat.fig"	,"1503701484723_confMat.fig"	,"1503702810845_confMat.fig","1503704008775_confMat.fig"	,"1503944237832_confMat.fig","1503945980566_confMat.fig"	,"1503948467876_confMat.fig"	,"1503955687111_confMat.fig","1503957322493_confMat.fig","1503959170110_confMat.fig"	
];

graphNames_SVM=["1503510449718_confMatSVM.fig","1503512024740_confMatSVM.fig","1503513662628_confMatSVM.fig"	,"1503515171349_confMatSVM.fig"	,"1503523593605_confMatSVM.fig"	,"1503525230880_confMatSVM.fig","1503600471339_confMatSVM.fig"	,"1503601791851_confMatSVM.fig"	,"1503604387983_confMatSVM.fig"	,"1503610324174_confMatSVM.fig"	,"1503612761276_confMatSVM.fig"	,"1503614529248_confMatSVM.fig"	,"1503616371604_confMatSVM.fig","1503618071641_confMatSVM.fig"	,"1503683563307_confMatSVM.fig"	,"1503685368577_confMatSVM.fig","1503686805336_confMatSVM.fig"	,"1503688257359_confMatSVM.fig"	,"1503695352765_confMatSVM.fig"	,"1503697313323_confMatSVM.fig"	,"1503698678322_confMatSVM.fig"	,"1503701484723_confMatSVM.fig"	,"1503702810845_confMatSVM.fig","1503704008775_confMatSVM.fig"	,"1503944237832_confMatSVM.fig","1503945980566_confMatSVM.fig"	,"1503948467876_confMatSVM.fig"	,"1503955687111_confMatSVM.fig","1503957322493_confMatSVM.fig","1503959170110_confMatSVM.fig"	
];

resFileNames_eating=["eatingVals_1503510449718.csv","eatingVals_1503512024740.csv","eatingVals_1503513662628.csv"	,"eatingVals_1503515171349.csv"	,"eatingVals_1503523593605.csv"];
resFileNames_noneating=["noneatingVals_1503510449718.csv","noneatingVals_1503512024740.csv","noneatingVals_1503513662628.csv"	,"noneatingVals_1503515171349.csv"	,"noneatingVals_1503523593605.csv"];

userIndepAnalysisData = [];
accuracyMeasures = [];

for it = 1:29
    
    currAccuracyMeasure = [];
    disp(fileNames_IMU(it));
    datIMU=csvread(fileNames_IMU(it));
    [r,c]=size(datIMU);

    datIMU_1=datIMU(:,1);
    datIMU_2=datIMU(:,2);
    datIMU_3=datIMU(:,3);
    datIMU_4=datIMU(:,4);
    datIMU_5=datIMU(:,5);
    datIMU_6=datIMU(:,6);
    datIMU_7=datIMU(:,7);
    datIMU_8=datIMU(:,8);
    datIMU_9=datIMU(:,9);
    datIMU_10=datIMU(:,10);
    datIMU_11=datIMU(:,11);
    [rtemp,ctemp]=size(datIMU_11);
    paddingVal=rtemp;
    temp_extraIMU=zeros(paddingVal,1);

    datIMU_new=horzcat(datIMU,temp_extraIMU,temp_extraIMU,temp_extraIMU,temp_extraIMU,temp_extraIMU,temp_extraIMU,temp_extraIMU,temp_extraIMU);

    %datEMG=csvread('1503512024740_EMG.csv');
    datEMG=csvread(fileNames_EMG(it));
    [r1,c1]=size(datEMG);

    datEMG_1=datEMG(:,1);
    datEMG_2=datEMG(:,2);
    datEMG_3=datEMG(:,3);
    datEMG_4=datEMG(:,4);
    datEMG_5=datEMG(:,5);
    datEMG_6=datEMG(:,6);
    datEMG_7=datEMG(:,7);
    datEMG_8=datEMG(:,8);
    datEMG_9=datEMG(:,9);

    [rtempEMG,ctempEMG]=size(datEMG_9);
    paddingValEmg=rtempEMG;
    temp_extra1EMG=zeros(rtempEMG,1);

    datEMG_new=horzcat(datEMG_1, temp_extra1EMG,temp_extra1EMG,temp_extra1EMG,temp_extra1EMG,temp_extra1EMG,temp_extra1EMG,temp_extra1EMG,temp_extra1EMG,temp_extra1EMG,temp_extra1EMG,datEMG_2,datEMG_3,datEMG_4,datEMG_5,datEMG_6,datEMG_7,datEMG_8,datEMG_9);

    dat_IMU_EMG_new=vertcat(datIMU_new, datEMG_new);

    dat_IMU_EMG_sorted=sortrows(dat_IMU_EMG_new);

    [rdat_IMU_EMG_sorted, cdat_IMU_EMG_sorted]=size(dat_IMU_EMG_sorted);

    %datGT=csvread('1503512024740.csv');
    datGT=csvread(fileNames_gT(it));
    [rGT, cGT]=size(datGT);
    fulleating=[];
    for i= 1:rGT

        fr=datGT(i,1);
        to=datGT(i,2);
        eating=fr:1:to;
        eating=transpose(eating);
        fulleating=vertcat(fulleating,eating);

    end
    [rfullEating, cfullEating]=size(fulleating);

    for i = 1:rfullEating
        fulleating(i)=floor(fulleating(i)*1.667);
    end

    annotations=[];

    eatingMat=[];
    noneatingMat=[];

    for i= 1:rdat_IMU_EMG_sorted

        if ismember(i,fulleating)
            eatingMat=vertcat(eatingMat,dat_IMU_EMG_sorted(i,:));
            annotations(i)=1;
        else
            noneatingMat=vertcat(noneatingMat,dat_IMU_EMG_sorted(i,:));
            annotations(i)=0;
        end
    end
    annotations=transpose(annotations);
    dat_IMU_EMG_sorted=horzcat(dat_IMU_EMG_sorted,annotations);

    %dat_IMU_EMG_new = dat_IMU_EMG_sorted(2:19);

    Col2 = dat_IMU_EMG_sorted(:,2);
    Col3 = dat_IMU_EMG_sorted(:,3);
    Col4 = dat_IMU_EMG_sorted(:,4);
    Col5 = dat_IMU_EMG_sorted(:,5);
    Col6 = dat_IMU_EMG_sorted(:,6);
    Col7 = dat_IMU_EMG_sorted(:,7);
    Col8 = dat_IMU_EMG_sorted(:,8);
    Col9 = dat_IMU_EMG_sorted(:,9);
    Col10 = dat_IMU_EMG_sorted(:,10);
    Col11 = dat_IMU_EMG_sorted(:,11);
    Col12 = dat_IMU_EMG_sorted(:,12);
    Col13 = dat_IMU_EMG_sorted(:,13);
    Col14 = dat_IMU_EMG_sorted(:,14);
    Col15 = dat_IMU_EMG_sorted(:,15);
    Col16 = dat_IMU_EMG_sorted(:,16);
    Col17 = dat_IMU_EMG_sorted(:,17);
    Col18 = dat_IMU_EMG_sorted(:,18);
    Col19 = dat_IMU_EMG_sorted(:,19);

    dat_IMU_EMG_new = horzcat(Col2,Col3,Col4,Col5,Col6,Col7,Col8,Col9,Col10,Col11,Col12,Col13,Col14,Col15,Col16,Col17,Col18,Col19);

    [ coeffNE, scoreNE, latentNE ] = pca( ( dat_IMU_EMG_new ) );
    disp( coeffNE );
    disp( scoreNE );
    disp( latentNE );

    pcaOutput = horzcat( coeffNE(:,1), coeffNE(:,2), coeffNE(:,3), coeffNE(:,4), coeffNE(:,5), coeffNE(:,6),coeffNE(:,7) );

    dat_IMU_EMG_new = mtimes(dat_IMU_EMG_new, pcaOutput);

    dat_IMU_EMG_new = horzcat( dat_IMU_EMG_new, annotations );
    shuffled_dat_IMU_EMG_new = dat_IMU_EMG_new(randperm(size(dat_IMU_EMG_new,1)),:);

    [rows, columns] = size(shuffled_dat_IMU_EMG_new);
    
    NN_data = horzcat(shuffled_dat_IMU_EMG_new(:,1),shuffled_dat_IMU_EMG_new(:,2), shuffled_dat_IMU_EMG_new(:,3), shuffled_dat_IMU_EMG_new(:,4),shuffled_dat_IMU_EMG_new(:,5),shuffled_dat_IMU_EMG_new(:,6),shuffled_dat_IMU_EMG_new(:,7));
    NN_Labels = shuffled_dat_IMU_EMG_new(:,8);
    
    disp('Stop here');
    
    %{
    splitSize = floor(rows * 0.6);
    
    userIndepAnalysisData = vertcat(userIndepAnalysisData, shuffled_dat_IMU_EMG_new(1:1000,:));
    
    trainingData = shuffled_dat_IMU_EMG_new(1:splitSize,:);
    testingData = shuffled_dat_IMU_EMG_new(splitSize+1:rows,:);

    trainingData_new = horzcat(trainingData(:,1),trainingData(:,2), trainingData(:,3), trainingData(:,4), trainingData(:,5), trainingData(:,6), trainingData(:,7) );
    trainingLabels = trainingData(:,8);

    testingData_new = horzcat(testingData(:,1),testingData(:,2),testingData(:,3),testingData(:,4),testingData(:,5),testingData(:,6),testingData(:,7));
    testingLabels = testingData(:, 8);

    dtree = fitctree(trainingData_new, trainingLabels);
    dtreePredicition = predict(dtree, testingData_new);

    confusionMatrix = confusionmat(testingLabels, dtreePredicition);
    tp = confusionMatrix(1, 1);
    tn = confusionMatrix(1, 2);
    fp = confusionMatrix(2, 1);
    fn = confusionMatrix(2, 2);
    %Precision, Recall, F1 score
    
    precision_dt = tp / (tp + fp);
    recall_dt = tp / (tp + fn);
    f1Score_dt = (2 * precision_dt * recall_dt) / (precision_dt + recall_dt);
    
    disp(confusionMatrix);
    confMatFig = confusionchart(confusionMatrix);
    %saveas(confMatFig,graphNames_dt(it));
    disp('Decision tree accuaracy');
    disp(precision_dt);
    disp(recall_dt);
    disp(f1Score_dt);

    %SVM Classification :
    %SVM_Model = fitcsvm(trainingData_new, trainingLabels);
    SVM_Model = fitcsvm(trainingData_new,trainingLabels,'Standardize',true,'KernelFunction','RBF',...
        'KernelScale','auto');
    SVMPrediction = predict(SVM_Model, testingData_new);
    
    confusionMatrix_SVM = confusionmat(testingLabels, SVMPrediction);
    tp = confusionMatrix_SVM(1, 1);
    tn = confusionMatrix_SVM(1, 2);
    fp = confusionMatrix_SVM(2, 1);
    fn = confusionMatrix_SVM(2, 2);
    %Precision, Recall, F1 score
    
    precision_SVM = tp / (tp + fp);
    recall_SVM = tp / (tp + fn);
    f1Score_SVM = (2 * precision_SVM * recall_SVM) / (precision_SVM + recall_SVM);
    disp(confusionMatrix_SVM);
    confMatFigSVM = confusionchart(confusionMatrix);
    %saveas(confMatFigSVM,graphNames_SVM(it));
    disp('SVM accuracy :');
    disp(precision_SVM);
    disp(recall_SVM);
    disp(f1Score_SVM);
    
    currAccuracyMeasure = horzcat(fileNames_IMU(it), precision_dt, recall_dt, f1Score_dt, precision_SVM, recall_SVM, f1Score_SVM);
    accuracyMeasures = vertcat(accuracyMeasures, currAccuracyMeasure);
    %}
    %{
    sv = SVMModel.SupportVectors;
    figure
    gscatter(X(:,1),X(:,2),y)
    hold on
    plot(sv(:,1),sv(:,2),'ko','MarkerSize',10)
    legend('versicolor','virginica','Support Vector')
    hold off
    %}

    %{
    net.numInputs = 7
    net.numLayers = 2
    %biasConnect 
    %inputConnect
    %layerConnect
    %outputConnect

    net = network;
    net = network(net.numInputs,net.numLayers);
    net.trainFcn = 'trainlm';
    net = train(net, trainingData_new, trainingLabels);
    [YPred, scores] = classify(net, testingData_new);
    disp(YPred);
    disp(scores);

    %}
    
end    


disp(accuracyMeasures);
disp('End');
csvwrite('userIndAnalysis.csv',userIndepAnalysisData);